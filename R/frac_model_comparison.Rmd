---
title: "frac_model_comparison"
author: "Sam Haynes"
date: '2022-06-14'
output: pdf_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(here)

latent_model_results_skewed_multi_condition <-  read_tsv(here("data/output/diff_frac_models/latent_model_skewed_multi_condition_count.tsv"))

simulate_fractions_ground_truth <-  read_tsv(here("data/output/simulated_counts/sup_pel_simulated_fractions.tsv")) 

DESeq2_model_iserman_results <- read_tsv(here("./data/output/diff_frac_models/DESeq2_iserman_counts.tsv"))

DESeq2_model_encode_results <- read_tsv(here("./data/output/diff_frac_models/DESeq2_encode_counts.tsv"))

DESeq2_model_simulated_results <- read_tsv(here("./data/output/diff_frac_models/DESeq2_simulated_counts.tsv"))
```

```{r compare-DESeq-vs-simulated-ground-truth}
simulated_condition_dictionary <- tibble(condition_number = 1:3,
                                         condition_name = c("random", "marginal", "specific"))

DESeq_vs_ground_truth_data_set <- simulate_fractions_ground_truth %>%
  inner_join(simulated_condition_dictionary,
             by = c(condition = "condition_number")) %>%
  transmute(gene_name, condition = condition_name, GT_log2foldchange = log2(pel_frac/sup_frac)) %>%
  inner_join(DESeq2_model_simulated_results %>%
               transmute(gene_name, condition, 
                         DESeq_log2foldchange = log2FoldChange, 
                         sig = padj < 0.05))

ggplot(DESeq_vs_ground_truth_data_set) +
  geom_point(aes(x = GT_log2foldchange, y=DESeq_log2foldchange, colour = sig)) +
  theme_bw() +
  geom_abline(intercept = 0, slope = 1) +
  facet_wrap(~condition) +
  coord_equal()
```

```{r compare-DESeq-iserman-conditions}

ggplot(DESeq2_model_iserman_results %>%
  select(-baseMean, -padj) %>%
  pivot_wider(names_from = condition, values_from = log2FoldChange)) +
  geom_point(aes(x = WT_30C, y =WT_40C)) +
  coord_equal() +
  geom_abline(intercept = 0, slope = 1)

ggplot(DESeq2_model_iserman_results %>%
  select(-baseMean, -padj) %>%
  pivot_wider(names_from = condition, values_from = log2FoldChange)) +
  geom_point(aes(x = WT_30C, y =WT_42C)) +
  coord_equal() +
  geom_abline(intercept = 0, slope = 1)

ggplot(DESeq2_model_iserman_results %>%
  select(-baseMean, -padj) %>%
  pivot_wider(names_from = condition, values_from = log2FoldChange)) +
  geom_point(aes(x = WT_40C, y =WT_42C)) +
  coord_equal() +
  geom_abline(intercept = 0, slope = 1)
```

```{r plot-DESeq-encode-results}

ggplot(DESeq2_model_encode_results) +
  geom_point(aes(x = log2FoldChange, y =-log10(padj))) 

```